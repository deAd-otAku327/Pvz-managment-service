# AvitoTech_pvz_service
Сервис для работы с ПВЗ (пункты выдачи заказов).
## Основные задействованные инструменты:
1. gorilla/mux для роутинга
2. gorilla/schema для парсинга query-параметров в DTO
3. Masterminds/squirrel для построения SQL-запросов
4. golang-jwt/jwt/v5 для работы с JWT-токенами
5. ory/dockertest для одноразовых docker-контейнеров в интеграционных тестах

## Быстрый старт
```bash
make
```
```bash
make migrate-up
```

## Остановить приложение:
```bash
make stop
```
или
```bash
make remove
```

## Описание Makefile
1. Сборка и запуск приложения
```bash
make all
```

2. Собирает Docker-образ приложения
```bash
make build
```

3. Запускает Docker-контейнер с приложением
```bash
make run
```

4. Останавливает Docker-контейнер с приложением (без удаления контейнеров)
```bash
make stop
```

5. Останавливает Docker-контейнер с приложением (удаляя контейнеры)
```bash
make remove
```

6. Накатывает миграции базы данных
```bash
make migrate-up
```

7. Откатывает миграции базы данных
```bash
make migrate-down
```

8. Запсукает unit-тестирование директории ./internal с подсчетом total-покрытия
```bash
make test
```

9. Запускает интеграционное тестирование
```bash
make integration
```

10. Удаляет контейнер с БД в случае ручного прерывания интеграционного тестирования (не рекомендуется)
```bash
make clear-for-integration
```

> [!NOTE]
> Для работы с командами миграциями на Win предусмотрен флаг os=win      
> Пример:
> ```bash
> make os=win migrate-up
> ```

## Особенности и принятые решения

1. Формат date-time значений в ответах приведен ниже. Параметры данного типа значений для фильтрации в GET /pvz содержит только дату в том же формате.
    ```bash
    "2006-01-02 15:04:05"
    ```
2. В сущность Товар было добавлено поле "receptionID" для соотвествия таблице БД и однонаправленности связей между сущностями. По той же причине поле []Products у сущности Reception присутствует только на уровне бизнес-логики и выше.
   
3. Для билда приложения использована multystage-сборка на основе образа golang:1.24.2-alpine, т.к. в образе golang:1.24.2 обнаружена критическая уязвимость.
   
4. Ручки /register и /login заведены на уровне контроллера, но отдают StatusNotImplemented, однако БД под них адаптирована (таблица users) и написаны DTO.
   
5. Интеграционное тестирование может не запускаться, ссылаясь на уже существующий контейнер с БД, после ручного прерывания тестирования. В таком случае необходимо использовать функционал очистки, предоставленный в Makefile